# Конфигурация для Amvera Cloud
version: 1

meta:
  environment: docker
  toolchain:
    name: docker

build:
  dockerfile: Dockerfile
  args:
    REACT_APP_API_URL: https://amvera-limslava-run-trader

run:
  containerPort: 80
  env:
    # Server configuration
    PORT: 80
    NODE_ENV: production
    APP_HOST: 0.0.0.0
    APP_PORT: 80
    PROTOCOL: http
    
    # Security & Authentication
    JWT_SECRET: russian-trader-2024-secure-jwt-key-32-chars-min
    JWT_EXPIRES_IN: 24h
    
    # Database (PostgreSQL)
    DATABASE_URL: postgresql://Trader:312046@amvera-limslava-cnpg-traderbd-rw:5432/russian_trader?schema=public&sslmode=require
    
    # CORS & Frontend URLs
    CORS_ORIGINS: https://amvera-limslava-run-trader
    FRONTEND_URL: https://amvera-limslava-run-trader
    REACT_APP_API_URL: https://amvera-limslava-run-trader
    REACT_APP_WS_URL: wss://amvera-limslava-run-trader
    
    # External APIs
    MOEX_API_BASE_URL: https://iss.moex.com/iss
    BINANCE_API_BASE_URL: https://api.binance.com/api/v3
    
    # Performance & Rate Limiting
    RATE_LIMIT_WINDOW_MS: 900000
    RATE_LIMIT_MAX_REQUESTS: 100
    ANALYSIS_CACHE_TTL: 300000
    MARKET_DATA_UPDATE_INTERVAL: 60000
    
    # Development flags
    ENABLE_MOCK_DATA: false
    LOG_LEVEL: info

deploy:
  replicas: 1
  resources:
    memory: 1024Mi
    cpu: 500m